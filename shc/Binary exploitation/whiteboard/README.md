# Write-up of the challenge "whiteboard"

This challenge is part of the "Binary exploitation" category and earns 201 points.

# Goal of the challenge

The objective of this challenge is to feed the program a certain **number** that will eventually be zero.

## Program structure

```c
#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>

#define MAX_NOTES 10

typedef struct note
{
    char title[0x100];
    char content[0x100];
} note;

note notes[MAX_NOTES + 2];
int note_count = 0;

void banner()
{
    puts(" __       __  __        __    __                __                                            __ \n"
         "/  |  _  /  |/  |      /  |  /  |              /  |                                          /  |\n"
         "$$ | / \\ $$ |$$ |____  $$/  _$$ |_     ______  $$ |____    ______    ______    ______    ____$$ |\n"
         "$$ |/$  \\$$ |$$      \\ /  |/ $$   |   /      \\ $$      \\  /      \\  /      \\  /      \\  /    $$ |\n"
         "$$ /$$$  $$ |$$$$$$$  |$$ |$$$$$$/   /$$$$$$  |$$$$$$$  |/$$$$$$  | $$$$$$  |/$$$$$$  |/$$$$$$$ |\n"
         "$$ $$/$$ $$ |$$ |  $$ |$$ |  $$ | __ $$    $$ |$$ |  $$ |$$ |  $$ | /    $$ |$$ |  $$/ $$ |  $$ |\n"
         "$$$$/  $$$$ |$$ |  $$ |$$ |  $$ |/  |$$$$$$$$/ $$ |__$$ |$$ \\__$$ |/$$$$$$$ |$$ |      $$ \\__$$ |\n"
         "$$$/    $$$ |$$ |  $$ |$$ |  $$  $$/ $$       |$$    $$/ $$    $$/ $$    $$ |$$ |      $$    $$ |\n"
         "$$/      $$/ $$/   $$/ $$/    $$$$/   $$$$$$$/ $$$$$$$/   $$$$$$/   $$$$$$$/ $$/        $$$$$$$/ \n"
         "                                                                                                 \n"
         "The new cutting edge whiteboard - world wide trusted with the most secure information\n\n\n");
}

void add_secret_note()
{
    strcpy(notes[0].title, "secret\n");

    FILE *secret_file = fopen("secret.txt", "r");
    if (secret_file == NULL)
    {
        printf("Error opening secret file please contact the organizers");
        return EXIT_FAILURE;
    }

    fgets(notes[0].content, sizeof(notes[0].content), secret_file);

    fclose(secret_file);
}

unsigned int number_input()
{
    char input[0x32];
    fgets(&input, 0x32, stdin);
    if (strchr(&input, '-') != NULL)
    {
        printf("why should there be a note with a negative id? Let's just take the first note.\n\n");
        return 0;
    }
    return strtoul(&input, NULL, 10);
}

int menu()
{
    puts("What would you like to do?");
    puts("1. add a note");
    puts("2. view a note");
    puts("3. exit");
    printf(" > ");
    return number_input();
}

void add_note()
{
    if (note_count >= MAX_NOTES)
    {
        puts("Where do you plan on adding another note to this whiteboard? It's already more than full.\n\n");
        return;
    }

    note_count++;

    printf("title: ");
    fgets(&notes[note_count].title, sizeof(notes[note_count].title), stdin);

    printf("content: ");
    fgets(&notes[note_count].content, sizeof(notes[note_count].title), stdin);

    printf("created note with id %d\n\n", note_count - 1);
}

void view_note()
{
    printf("id: ");
    int note_id = number_input() + 1;
    if (note_id < 0)
    {
        printf("What did you expect would happen? Maybe try to search stuff that actually exists next time.\n\n");
        return;
    }
    if (note_id > note_count)
    {
        printf("After countless hours of searching your desired note still couldn't be located. Consider chosing another next time.\n\n");
        return;
    }

    puts("");
    printf("\033[1m%s\033[0m", &notes[note_id].title);
    printf("%s\n", &notes[note_id].content);
}

int main()
{
    setbuf(stdin, NULL);
    setbuf(stdout, NULL);
    setbuf(stderr, NULL);
    add_secret_note();
    banner();
    while (1)
    {
        switch (menu())
        {
        case 1:
            add_note();
            break;
        case 2:
            view_note();
            break;
        case 3:
            exit(EXIT_SUCCESS);
            break;

        default:
            puts("What did you say? The whiteboard couldn't quite understand it.\n\n");
            break;
        }
    }
}

```

## Security breach

Not doing any checks for integer overflow `if (note_id < 0)`.

## Solution

So what I did first was try to anaylze the program and I found out that the flag is in **Note 0**, as we can see:

```c
strcpy(notes[0].title, "secret\n");
```

However the problem is that we can't access the index 0 becuase it always adds one to our input:

```c
int note_id = number_input() + 1;
```

So what I tried was to put a negative number **-1** which will lead to:

```c
int note_id = -1 + 1;
```

which will fail this check:

```c
  if (note_id < 0)
    {
        printf("What did you expect would happen? Maybe try to search stuff that actually exists next time.\n\n");
        return;
    }
```

So what I did lastly was to try to do **integer overflow** for unsigned int because it adds one we need to subtract `2**32` by one and we get lastly:

```
4294967295
```

If we send first **2** to view the note and then put this `4294967295` as the index we should eventually land at **0** and get our flag!
